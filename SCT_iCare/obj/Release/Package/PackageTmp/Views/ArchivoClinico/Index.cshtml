
@{

    ViewBag.Title = "Index";

    GMIEntities db = new GMIEntities();

    DateTime start = DateTime.Now;
    //DateTime startDay = Convert.ToDateTime(start.Day);

    var oUser = (Usuarios)HttpContext.Current.Session["User"];

    string nombreUsuario = null;
    int idUser = 0;
    int? idRol = 0;

    int idPaciente = Convert.ToInt32(ViewBag.idPaciente);

    if (oUser != null)
    {
        idUser = oUser.idUsuario;
        nombreUsuario = oUser.Nombre;
        idRol = oUser.idRol;
    }

    var nombrePaciente = (from d in db.Paciente where d.idPaciente == idPaciente select d.Nombre).FirstOrDefault();
    var expedientePaciente = (from d in db.Cita where d.idPaciente == idPaciente select d.NoExpediente).FirstOrDefault();
}

<!--<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - GMI</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Manrope&display=swap" rel="stylesheet">
    <link rel="icon" href="~/GMI.ico" />

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">

    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
    <link href="~/Content/Chart.min.css" rel="stylesheet" />

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</head>
<body style="background-color: white">
    <br />
    <h3 class="text-center text-primary">Carrusel Médico</h3>
    <br />-->

    @*<div style="width:100%">
            <center>
                @{
                    var modulos = from m in db.DoctorModulo where m.idUsuario == idUser select m.idModulo;

                    foreach (var item in modulos)
                    {
                        var nombreModulo = (from n in db.Modulos where n.idModulo == item select n.Nombre).FirstOrDefault();

                        <button class="btn btn-info" style="width:25vw; height:25vw; margin:0.5%; max-width: 200px; max-height:200px; white-space:normal; font-size: 75%">@nombreModulo</button>
                    }
                }
            </center>
        </div>*@

    <!--<div style="width:100%">
        <center>
            
        </center>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#aparicion1').fadeIn(1000);
            $('#aparicion2').fadeIn(1000);
            $('#aparicion3').fadeIn(1000);
            $('#aparicion4').fadeIn(1000);
            $('#aparicion5').fadeIn(1000);
            $('#aparicion6').fadeIn(1000);
            $('#aparicion7').fadeIn(1000);
            $('#aparicion8').fadeIn(1000);
            $('#aparicion9').fadeIn(1000);
        });
    </script>


</body>-->

<br />
<h3 class="text-center" style="color:white"><span style="color:darkgoldenrod">Carrusel Médico de: </span>@nombrePaciente (No. Expediente <b>@expedientePaciente</b>)</h3>
<br />

@*<div style="width:100%">
        <center>
            @{
                var modulos = from m in db.DoctorModulo where m.idUsuario == idUser select m.idModulo;

                foreach (var item in modulos)
                {
                    var nombreModulo = (from n in db.Modulos where n.idModulo == item select n.Nombre).FirstOrDefault();

                    <button class="btn btn-info" style="width:25vw; height:25vw; margin:0.5%; max-width: 200px; max-height:200px; white-space:normal; font-size: 75%">@nombreModulo</button>
                }
            }
        </center>
    </div>*@

<div style="width:100%">
    <center>
        @{

            int contador = 1;


            foreach (var item in db.Modulos)
            {
                string aparecer = "aparicion" + contador.ToString();
                var modulo = (from m in db.Modulos where m.idModulo == item.idModulo select m.idModulo).FirstOrDefault();
                if ((from i in db.DoctorModulo where i.idUsuario == idUser && i.idModulo == modulo select i).FirstOrDefault() == null)
                {
                    <button class="btn " style="width:25vw; height:25vw; margin:0.5%; max-width: 200px; max-height:200px; white-space:normal; font-size: 75%;display:none" id=@aparecer disabled>@item.Nombre</button>
                }
                else
                {
                    if (item.Nombre == "DICTAMEN")
                    {
                        <button class="btn btn-success" style="width:25vw; height:25vw; margin:0.5%; max-width: 200px; max-height:200px; white-space:normal; font-size: 75%;display:none" id=@aparecer>@item.Nombre</button>
                    }
                    else
                    {
                        string nombreModulo = item.Nombre;

                        if (nombreModulo == "SIGNOS VITALES")
                        {
                            nombreModulo = "SIGNOS_VITALES";
                        }
                        else if (nombreModulo == "HISTORIA CLÍNICA")
                        {
                            nombreModulo = "HISTORIA_CLÍNICA";
                        }

                        string moduloTabla = item.Nombre;
                        var consultaCompleta = (from c in db.CarruselMedico where c.InicioCarrusel != null && c.idPaciente == idPaciente select c).FirstOrDefault();

                        if (item.Nombre == "SIGNOS VITALES")
                        {
                            consultaCompleta = (from c in db.CarruselMedico where c.Fin_SignosVitales != null && c.idPaciente == idPaciente select c).FirstOrDefault();
                        }
                        else if (item.Nombre == "AUDIOLOGÍA")
                        {
                            consultaCompleta = (from c in db.CarruselMedico where c.Fin_Audiologia != null && c.idPaciente == idPaciente select c).FirstOrDefault();
                        }
                        else if (item.Nombre == "OFTALMOLOGÍA")
                        {
                            consultaCompleta = (from c in db.CarruselMedico where c.Fin_Oftalmologia != null && c.idPaciente == idPaciente select c).FirstOrDefault();
                        }
                        else if (item.Nombre == "ODONTOLOGÍA")
                        {
                            consultaCompleta = (from c in db.CarruselMedico where c.Fin_Odontologia != null && c.idPaciente == idPaciente select c).FirstOrDefault();
                        }
                        else if (item.Nombre == "LABORATORIO")
                        {
                            consultaCompleta = (from c in db.CarruselMedico where c.Fin_Laboratorio != null && c.idPaciente == idPaciente select c).FirstOrDefault();
                        }
                        else if (item.Nombre == "HISTORIA CLÍNICA")
                        {
                            consultaCompleta = (from c in db.CarruselMedico where c.Fin_HistoriaClinica != null && c.idPaciente == idPaciente select c).FirstOrDefault();
                        }
                        else if (item.Nombre == "CARDIOLOGÍA")
                        {
                            consultaCompleta = (from c in db.CarruselMedico where c.Fin_Cardiologia != null && c.idPaciente == idPaciente select c).FirstOrDefault();
                        }

                        if (consultaCompleta != null)
                        {
                            <button type="button" class="btn btn-info" style="width:25vw; height:25vw; margin:0.5%; max-width: 200px; max-height:200px; white-space:normal; font-size: 75%;display:none" id=@aparecer data-toggle="modal" data-target="#carrusel_@idPaciente@nombreModulo">@item.Nombre <span style="color:gold">(COMPLETO)</span></button>

                            <div class="modal fade" id="carrusel_@idPaciente@nombreModulo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document" style="width:60%; min-width:300px">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            @{
                                                string nombrePacienteModal = (from n in db.Paciente where n.idPaciente == idPaciente select n.Nombre).FirstOrDefault();
                                                <h4 class="modal-title text-primary" id="exampleModalLabel"><b>Datos del examen @item.Nombre para @nombrePacienteModal</b></h4>
                                            }

                                        </div>
                                        <div class="modal-body" id="">
                                            <div class="tablaScroll">
                                                <table class="table tablas table-responsive" id="tablaEjemploSS" style="color: #2F2D6B">
                                                </table>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        }
                        else
                        {
                            @*<button class="btn btn-info" style="width:25vw; height:25vw; margin:0.5%; max-width: 200px; max-height:200px; white-space:normal; font-size: 75%;display:none" id=@aparecer>@item.Nombre</button>*@
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/ArchivoClinico/"+nombreModulo)" style="display:inline-block; margin:0.5%">
                                <input type="hidden" value="@idPaciente" name="id" />
                                <input type="submit" class="btn btn-info" style="width:25vw; height:25vw; margin:0.5%; max-width: 200px; max-height:200px; white-space:normal; font-size: 75%;display:none" id=@aparecer value="@item.Nombre" />
                            </form>
                        }
                    }
                }

                contador++;
            }
        }
    </center>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('#aparicion1').fadeIn(700);
        $('#aparicion2').fadeIn(700);
        $('#aparicion3').fadeIn(700);
        $('#aparicion4').fadeIn(700);
        $('#aparicion5').fadeIn(700);
        $('#aparicion6').fadeIn(700);
        $('#aparicion7').fadeIn(700);
        $('#aparicion8').fadeIn(700);
        $('#aparicion9').fadeIn(700);
    });
</script>



