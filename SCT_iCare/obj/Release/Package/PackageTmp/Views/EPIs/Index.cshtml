@model IEnumerable<SCT_iCare.EPI>

@{
    ViewBag.Title = "Index";

    var oUser = (Usuarios)HttpContext.Current.Session["User"];
    int idUser = oUser.idUsuario;
    string nombreUsuario = oUser.Nombre;

    SCTiCareEntities1 db = new SCTiCareEntities1();
    var Recepcion = (from r in db.Recepcionista where r.idUsuario == idUser select r.idSucursal).FirstOrDefault();
    var Hospital = (from h in db.Sucursales where h.idSucursal == Recepcion select h.Nombre).FirstOrDefault();
    string Sucursal = Hospital.ToString();

    DateTime start = DateTime.Now;
    //DateTime startDay = Convert.ToDateTime(start.Day);

    int year = start.Year;
    int month = start.Month;
    int day = start.Day;
    int tomorrorDay = day + 1;
    DateTime thisDate = new DateTime(year, month, day);
    DateTime tomorrowDate = new DateTime(year, month, tomorrorDay);

    var Restriccion = db.EPI.Select(i => new { i.Capturista, i.Dictamen, i.Doctor, i.Estatus, i.FechaExpediente, i.FinalCaptura, i.idEPI, i.InicioCaptura, i.NoFolio, i.NombrePaciente, i.Sucursal, i.TipoEPI, i.Usuario }).Where(w => w.FechaExpediente >= thisDate && w.FechaExpediente < tomorrowDate && w.Sucursal == Sucursal).ToList();

    int id1 = 0;

}

<br />
<br />
<h3 style="color:white" class="text-center">EPI Center</h3>
<h4 style="color:#AC9070" class="text-center">Sucursal: <span style="color:white">@Sucursal</span></h4>


<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal"><span class="glyphicon glyphicon-plus"></span> Nuevo</button>
<br />
<br />

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title text-primary" id="exampleModalLabel"><b>Subir archivo EPI</b></h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="post" enctype="multipart/form-data" action="@Url.Content("~/EPIs/Create")">
                    @Html.AntiForgeryToken()
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Nombre del Paciente:</label>
                        <input type="text" class="form-control" id="paciente" name="paciente" required>
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Número de Expediente:</label>
                        <input type="text" class="form-control" id="folio" name="folio" required>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                        <label class="form-check-label" for="flexCheckDefault">
                            Cita registrada en METRA
                        </label>
                    </div>
                    <br />
                    <div class="form-group">
                        <label for="file" class="col-form-label">Archivo:</label>
                        <input type="file" name="file" asp-for="file" class="" required value="file" />
                        <input type="hidden" name="sucursal" asp-for="file" class="" required value="@Sucursal" />
                        <input type="hidden" name="usuario" asp-for="file" class="" required value="@nombreUsuario" />
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Doctor:</label>

                        <select name="doctor" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                            @{
                                var consultorios = from c in db.Doctores select c;

                                foreach (var item in consultorios)
                                {
                                    <option value="@item.Nombre">@item.Nombre</option>
                                }
                            }
                        </select>

                    </div>

                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Tipo de Trámite:</label>

                        <select name="tipo" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                            <option value="REVALIDACIÓN">REVALIDACIÓN</option>
                            <option value="PRIMERA VEZ">PRIMERA VEZ</option>
                        </select>

                    </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <input type="submit" value="Subir PDF" class="btn btn-primary" />
            </div></form>
        </div>
    </div>
</div>


<table class="table tablas" style="color: #2F2D6B">
    <tr style="background-color:#62E3C9">
        <th>
            @Html.DisplayNameFor(model => model.NombrePaciente)
        </th>

        <th>
            NoExpediente
        </th>
        <th>
            @Html.DisplayNameFor(model => model.TipoEPI)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.FechaExpediente)
        </th>

        <th>
            @Html.DisplayNameFor(model => model.Doctor)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Sucursal)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Usuario)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Restriccion)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.NombrePaciente)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.NoFolio)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.TipoEPI)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.FechaExpediente)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.Doctor)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Sucursal)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Usuario)
            </td>
            <td>
                @*<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal1" data-id="@item.idEPI">Open modal for @item.idEPI</button>
                    @Html.ActionLink("Editar", "#", new { id = item.idEPI }, new { @data_toggle = "modal", @data_target = "#modalEdit" }) |
                    @Html.ActionLink("Detalles", "#", new { id = item.idEPI }, new { @data_toggle = "modal", @data_target = "#YourModalId" })*@
                @*@Html.ActionLink("Edit", "Edit", new { id = item.idEPI }) |
                    @Html.ActionLink("Details", "Details", new { id = item.idEPI }) |
                    @Html.ActionLink("Delete", "Delete", new { id = item.idEPI })*@
            </td>
        </tr>


    }

</table>

<div id="contenedor_carga">
    <div id="carga">
    </div>
</div>

<script>
    window.onload = function () {
        var contenedor = document.getElementById('contenedor_carga');

        contenedor.style.visibility = 'hidden';
        contenedor.style.opacity = '0';
    }
</script>



<script>
    $(document).on("click", "#exampleModal1", function () {
        var ide = $(this).data('id');

        $("#id").val(ide);
    })
</script>


@*<div class="modal fade" id="modalEdit" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title text-primary" id="exampleModalLabel"><b>Editar expediente EPI</b></h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form method="post" enctype="multipart/form-data" action="@Url.Content("~/EPIs/Edit")">
                        @Html.AntiForgeryToken()
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Nombre del Paciente: @id1</label>
                            <input type="text" class="form-control" id="paciente" name="paciente" required>
                        </div>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Número de Folio:</label>
                            <input type="text" class="form-control" id="folio" name="folio" required>
                        </div>
                        <div class="form-group">
                            <label for="file" class="col-form-label">Archivo:</label>
                            <input type="file" name="file" asp-for="file" class="" required value="file" />
                            <input type="hidden" name="sucursal" asp-for="file" class="" required value="@Sucursal" />
                            <input type="hidden" name="usuario" asp-for="file" class="" required value="@nombreUsuario" />
                        </div>
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Doctor:</label>

                            <select name="doctor" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                @{
                                    var consultorios1 = from c in db.Doctores where c.idSucursal == Recepcion select c;

                                    foreach (var item in consultorios1)
                                    {
                                        <option value="@item.Nombre">@item.Nombre</option>
                                    }
                                }
                            </select>

                        </div>

                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Tipo de EPI:</label>

                            <select name="tipo" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                <option value="PRIMERA VEZ">PRIMERA VEZ</option>
                                <option value="REVALIDACIÓN">REVALIDACIÓN</option>
                            </select>

                        </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <input type="submit" value="Subir PDF" class="btn btn-primary"/>
                </div></form>
            </div>
        </div>
    </div>*@

<div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">New message</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Recipient:</label>
                        <input type="text" class="form-control" id="ide">
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Message:</label>
                        <textarea class="form-control" id="message-text"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Send message</button>
            </div>
        </div>
    </div>
</div>
