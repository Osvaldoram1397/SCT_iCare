
@{
    ViewBag.Title = "TablaComparacion";

    GMIEntities db = new GMIEntities();

    string texto = "";
    string texto2 = "";

    string parentesisDerecho = "";
    string parentesisIZquierdo = "";

    string parentesisDerecho1 = "";
    string parentesisIZquierdo1 = "";

    DateTime fecha = new DateTime(DateTime.Today.Year, DateTime.Today.Month, 1);
    DateTime fecha1 = DateTime.Today.AddDays(1);

    DateTime fecha3 = fecha.AddMonths(-1);
    DateTime fecha4 = fecha3.AddMonths(1);

    int ultimoDiaMesAnterior = new DateTime(DateTime.Today.Year, DateTime.Today.Month, 1).AddDays(-1).Day;
    int diaCorriente = DateTime.Today.Day;

    if(diaCorriente > ultimoDiaMesAnterior)
    {
        fecha4 = new DateTime(DateTime.Today.Year, DateTime.Today.Month, ultimoDiaMesAnterior).AddMonths(-1);
    }
    else
    {
        fecha4 = new DateTime(DateTime.Today.Year, DateTime.Today.Month, diaCorriente).AddMonths(-1);
    }



    var canales = db.Canales;

    int metaTotal = 0;
    int realizadoTotal = 0;
    int realizadoTotalMesAnterior = 0;

    int realizadoTotalCalculo = 0;
    int realizadoTotalCalculoMesAnterior = 0;

    int realizadoHoy = 0;
    int realizadoHoyMesAnterior = 0;
    int realizadoHoyMesAnteriorDiferencia = 0;

    int realizadoTotalMesAnteriorFooter = 0;
    int planTotalMesAnteriorFooter = 0;

    double metaPorcentaje = 0.00;
    double metaPorcentajeMesAnterior = 0.00;
    double metaPorcentajeMesAnteriorDiferencia = 0.00;
    double metaPorcentajeMesAnteriorDiferenciaFooter = 0.00;

    foreach (var e in canales)
    {
        metaTotal += (Convert.ToInt32(e.Meta) / 30) * diaCorriente;
    }

    var realizadosCallCenter = db.Cita.Join(db.Captura, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m })
.Where(w => w.M.FinalCaptura != null && w.N.Canal == "Call Center");

    var realizadosALT = db.PacienteESP.Where(w => w.Capturista != null);

    var realizadosALTIS = 0;

    var realizadosGestores = db.Cita.Join(db.Captura, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).Join(db.Referido, o => o.N.ReferidoPor, p => p.Nombre, (o, p) => new { O = o, P = p })
                .Where(w => w.O.M.FinalCaptura != null && w.P.Tipo == "Gestor");

    var realizadosMedia = 0;

    var realizadosCATEM = db.Cita.Join(db.Captura, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).Join(db.Referido, o => o.N.ReferidoPor, p => p.Nombre, (o, p) => new { O = o, P = p })
                .Where(w => w.O.M.FinalCaptura != null && w.P.Tipo.Contains("CATEM"));

    var realizadosEmpresas = db.Cita.Join(db.Captura, n => n.idPaciente, m => m.idPaciente, (n, m) => new { N = n, M = m }).Join(db.Referido, o => o.N.ReferidoPor, p => p.Nombre, (o, p) => new { O = o, P = p })
                .Where(w => w.O.M.FinalCaptura != null && w.P.Tipo == "Empresa");


    foreach (var item in canales)
    {
        if (item.NombreCanal == "Call Center")
        {
            realizadoHoy = realizadosCallCenter.Where(w => w.M.FechaExpdiente >= fecha && w.M.FechaExpdiente < fecha1).Count();
        }
        else if (item.NombreCanal == "CATEM")
        {
            realizadoHoy = realizadosCATEM.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
        }
        else if (item.NombreCanal == "ALT")
        {
            realizadoHoy = realizadosALT.Where(w => w.FechaCaptura >= fecha && w.FechaCaptura < fecha1).Count();
        }
        else if (item.NombreCanal == "Gestores")
        {
            realizadoHoy = realizadosGestores.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
        }
        else if (item.NombreCanal == "Empresas")
        {
            realizadoHoy = realizadosEmpresas.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
        }
        else if (item.NombreCanal == "ALT IS")
        {
            realizadoHoy = 0;
        }
        else if (item.NombreCanal == "Medios Digitales")
        {
            realizadoHoy = 0;
        }
        realizadoTotalCalculo += realizadoHoy;
    }

    foreach (var item in canales)
    {
        if (item.NombreCanal == "Call Center")
        {
            realizadoHoyMesAnterior = realizadosCallCenter.Where(w => w.M.FechaExpdiente >= fecha3 && w.M.FechaExpdiente < fecha4).Count();
        }
        else if (item.NombreCanal == "CATEM")
        {
            realizadoHoyMesAnterior = realizadosCATEM.Where(w => w.O.M.FechaExpdiente >= fecha3 && w.O.M.FechaExpdiente < fecha4).Count();
        }
        else if (item.NombreCanal == "ALT")
        {
            realizadoHoyMesAnterior = realizadosALT.Where(w => w.FechaCaptura >= fecha3 && w.FechaCaptura < fecha4).Count();
        }
        else if (item.NombreCanal == "Gestores")
        {
            realizadoHoyMesAnterior = realizadosGestores.Where(w => w.O.M.FechaExpdiente >= fecha3 && w.O.M.FechaExpdiente < fecha4).Count();
        }
        else if (item.NombreCanal == "Empresas")
        {
            realizadoHoyMesAnterior = realizadosEmpresas.Where(w => w.O.M.FechaExpdiente >= fecha3 && w.O.M.FechaExpdiente < fecha4).Count();
        }
        else if (item.NombreCanal == "ALT IS")
        {
            realizadoHoyMesAnterior = 0;
        }
        else if (item.NombreCanal == "Medios Digitales")
        {
            realizadoHoyMesAnterior = 0;
        }
        realizadoTotalCalculoMesAnterior += realizadoHoyMesAnterior;
    }

}

<br />
<h2 style="color:white">Tabla Comparativa <span style="color:goldenrod">@DateTime.Now.ToString("MMMM-yy").ToUpper()</span></h2>
<br />

<form class="form-inline" method="post" enctype="multipart/form-data" action="@Url.Content("~/Admin/TablaComparacion")">
    <div>

        <select name="gestor" style="font-size:2vh" class="form-control">
            <option>Seleccionar</option>
            <option value="Diarias">METAS DIARIAS</option>
            <option value="Semanales">METAS SEMANALES</option>
            <option value="Sucursales">SUCURSALES</option>
            @*<option value="CallCenter">CALL CENTER</option>
        <option value="Gestores">GESTORES</option>*@
            <option value="Alternativos">ACUMULADO ALT</option>
            <option value="Comparacion">COMPARACIÓN</option>
            <option value="Doctores">DOCTORES</option>
            <option disabled>-------------------------</option>
            <option value="Metas">ACTUALIZAR METAS</option>
        </select>
        @*<input type="month" class="form-control" />*@
        <input type="submit" class="btn btn-info" value="Enviar" />
    </div>
</form>

<br />
<h3 style="color:white">Mensual</h3>
<div class="tablaScroll">
    <table class="table  table-bordered table-hover tablas" style="color: #2F2D6B">
        <thead>
            <tr style="color:white">
                <th rowspan="2" style="text-align:center">
                    Año Anterior
                </th>
                <th rowspan="2" style="text-align:center">
                    Mes Anterior
                </th>
                <th rowspan="2" style="text-align:center">
                    Plan
                </th>
                <th rowspan="2" style="text-align:center">
                    Real
                </th>
                <th rowspan="2" style="text-align:center">
                    @DateTime.Now.ToString("dd-MMMM-yy").ToUpper()
                </th>
                <th colspan="3" style="font-size:x-small; text-align:center">
                    COMPARATIVO
                </th>
            </tr>
            <tr style="color:white">
                <th style="text-align:center">
                    Plan vs Real
                </th>
                <th style="text-align:center">
                    Mes Anterior
                </th>
                <th style="text-align:center">
                    Año Anterior
                </th>
            </tr>
        </thead>

        @{
            foreach (var item in canales)
            {
                <tr>
                    <td style="text-align:center">
                    </td>
                    <td style="text-align:center">
                        @{
                            if (item.NombreCanal == "Call Center")
                            {
                                realizadoHoyMesAnterior = realizadosCallCenter.Where(w => w.M.FechaExpdiente >= fecha3 && w.M.FechaExpdiente < fecha4).Count();
                            }
                            else if (item.NombreCanal == "CATEM")
                            {
                                realizadoHoyMesAnterior = realizadosCATEM.Where(w => w.O.M.FechaExpdiente >= fecha3 && w.O.M.FechaExpdiente < fecha4).Count();
                            }
                            else if (item.NombreCanal == "ALT")
                            {
                                realizadoHoyMesAnterior = realizadosALT.Where(w => w.FechaCaptura >= fecha3 && w.FechaCaptura < fecha4).Count();
                            }
                            else if (item.NombreCanal == "Gestores")
                            {
                                realizadoHoyMesAnterior = realizadosGestores.Where(w => w.O.M.FechaExpdiente >= fecha3 && w.O.M.FechaExpdiente < fecha4).Count();
                            }
                            else if (item.NombreCanal == "Empresas")
                            {
                                realizadoHoyMesAnterior = realizadosEmpresas.Where(w => w.O.M.FechaExpdiente >= fecha3 && w.O.M.FechaExpdiente < fecha4).Count();
                            }
                            else if (item.NombreCanal == "ALT IS")
                            {
                                realizadoHoyMesAnterior = 0;
                            }
                            else if (item.NombreCanal == "Medios Digitales")
                            {
                                realizadoHoyMesAnterior = 0;
                            }
                            realizadoTotalMesAnterior += realizadoHoyMesAnterior;
                            metaPorcentaje = (Convert.ToDouble(realizadoHoyMesAnterior) * 100) / realizadoTotalCalculoMesAnterior;

                            if(realizadoHoyMesAnterior == 0)
                            {
                                metaPorcentaje = 0;
                            }

                            metaPorcentajeMesAnterior = metaPorcentaje;
                        }
                        <b>@realizadoHoyMesAnterior</b><span class="pull-right" style="font-size:small">@metaPorcentaje.ToString("##.##")%</span>
                    </td>
                    <td style="text-align:center">
                        @{
                            metaPorcentaje = (Convert.ToDouble((Convert.ToDouble(item.Meta) / 30) * DateTime.Today.Day) * 100) / metaTotal;
                        }
                        <b>@Convert.ToInt32((Convert.ToInt32(item.Meta) / 30) * DateTime.Today.Day)</b><span class="pull-right" style="font-size:small">@metaPorcentaje.ToString("##.##")%</span>
                    </td>
                    <td style="text-align:center">
                        @{
                            if (item.NombreCanal == "Call Center")
                            {
                                realizadoHoy = realizadosCallCenter.Where(w => w.M.FechaExpdiente >= fecha && w.M.FechaExpdiente < fecha1).Count();
                            }
                            else if (item.NombreCanal == "CATEM")
                            {
                                realizadoHoy = realizadosCATEM.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
                            }
                            else if (item.NombreCanal == "ALT")
                            {
                                realizadoHoy = realizadosALT.Where(w => w.FechaCaptura >= fecha && w.FechaCaptura < fecha1).Count();
                            }
                            else if (item.NombreCanal == "Gestores")
                            {
                                realizadoHoy = realizadosGestores.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
                            }
                            else if (item.NombreCanal == "Empresas")
                            {
                                realizadoHoy = realizadosEmpresas.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
                            }
                            else if (item.NombreCanal == "ALT IS")
                            {
                                realizadoHoy = 0;
                            }
                            else if (item.NombreCanal == "Medios Digitales")
                            {
                                realizadoHoy = 0;
                            }
                            realizadoTotal += realizadoHoy;
                            metaPorcentaje = (Convert.ToDouble(realizadoHoy) * 100) / realizadoTotalCalculo;
                            metaPorcentajeMesAnteriorDiferencia = metaPorcentaje - metaPorcentajeMesAnterior;
                            metaPorcentajeMesAnteriorDiferenciaFooter += metaPorcentajeMesAnteriorDiferencia;

                            int planDiferencia = realizadoHoy - Convert.ToInt32((Convert.ToInt32(item.Meta) / 30) * DateTime.Today.Day);

                            planTotalMesAnteriorFooter += planDiferencia;

                        }
                        <b>@realizadoHoy</b><span class="pull-right" style="font-size:small">@metaPorcentaje.ToString("##.##")%</span>
                    </td>
                    <td class="bg-info" style="text-align:center">
                        <b>@item.NombreCanal</b>
                    </td>
                    <td style="text-align:center">
                        @if (planDiferencia > 0)
                        {
                            texto = "text-success";
                        }
                        else if (planDiferencia < 0)
                        {
                            texto = "text-danger";
                            parentesisDerecho = ")";
                            parentesisIZquierdo = "(";
                        }

                        @{ 
                            //double porcentajePlanDiferencia = Convert.ToDouble((100 * Convert.ToDouble(item.Meta)) / db.Canales.Sum(s => s.Meta));
                            //double porcentajePlanDiferencia = metaPorcentaje - ((Convert.ToDouble(item.Meta)) * 100 / Convert.ToDouble(metaTotal));
                            double porcentajePlanDiferencia = (planDiferencia * 100) / Convert.ToDouble((Convert.ToDouble(item.Meta) / 30) * DateTime.Today.Day);
                            porcentajePlanDiferencia = realizadoHoy == 0 ? 0 : porcentajePlanDiferencia;

                            if (porcentajePlanDiferencia > 0)
                            {
                                texto2 = "text-success";
                            }
                            else if (porcentajePlanDiferencia < 0)
                            {
                                texto2 = "text-danger";
                                parentesisDerecho1 = ")";
                                parentesisIZquierdo1 = "(";
                            }

                            planDiferencia *= planDiferencia < 0 ? -1 : 1;
                            porcentajePlanDiferencia *= porcentajePlanDiferencia < 0 ? -1 : 1;
                        }
                        <b class="@texto">@parentesisIZquierdo@planDiferencia@parentesisDerecho</b>
                        <span class="pull-right @texto2" style="font-size:small">@parentesisIZquierdo1@porcentajePlanDiferencia.ToString("##.##")@parentesisDerecho1%</span>
                        @{
                            parentesisDerecho = "";
                            parentesisIZquierdo = "";

                            parentesisDerecho1 = "";
                            parentesisIZquierdo1 = "";
                        }

                    </td>
                    <td style="text-align:center">
                        @{
                            realizadoHoyMesAnteriorDiferencia = realizadoHoy - realizadoHoyMesAnterior;

                            if (realizadoHoyMesAnteriorDiferencia > 0)
                            {
                                texto = "text-success";
                            }
                            else if (realizadoHoyMesAnteriorDiferencia < 0)
                            {
                                texto = "text-danger";
                                parentesisDerecho = ")";
                                parentesisIZquierdo = "(";
                            }

                            if(realizadoHoyMesAnterior == 0)
                            {
                                metaPorcentajeMesAnteriorDiferencia = 0;
                            }
                            else
                            {
                                metaPorcentajeMesAnteriorDiferencia = (realizadoHoyMesAnteriorDiferencia * 100) / realizadoHoyMesAnterior;
                            }

                            if (metaPorcentajeMesAnteriorDiferencia > 0)
                            {
                                texto2 = "text-success";
                            }
                            else if (metaPorcentajeMesAnteriorDiferencia < 0)
                            {
                                texto2 = "text-danger";
                                parentesisDerecho1 = ")";
                                parentesisIZquierdo1 = "(";
                            }

                            realizadoHoyMesAnteriorDiferencia *= realizadoHoyMesAnteriorDiferencia < 0 ? -1 : 1;
                            metaPorcentajeMesAnteriorDiferencia *= metaPorcentajeMesAnteriorDiferencia < 0 ? -1 : 1;

                            <b class="@texto">@parentesisIZquierdo@realizadoHoyMesAnteriorDiferencia@parentesisDerecho</b>
                            <span class="pull-right @texto2" style="font-size:small">@parentesisIZquierdo1@metaPorcentajeMesAnteriorDiferencia.ToString("##.##")@parentesisDerecho1%</span>
                            texto = "";
                            texto2 = "";

                            parentesisDerecho = "";
                            parentesisIZquierdo = "";

                            parentesisDerecho1 = "";
                            parentesisIZquierdo1 = "";

                            realizadoHoyMesAnteriorDiferencia *= realizadoHoyMesAnteriorDiferencia > 0 ? -1 : 1;

                            realizadoTotalMesAnteriorFooter += realizadoHoyMesAnteriorDiferencia;
                        }
                    </td>
                    <td style="text-align:center">
                    </td>
                </tr>
            }
        }

        <tr>
            <td class="bg-info" style="text-align:center">
            </td>
            <td class="bg-info" style="text-align:center">
                <b>@realizadoTotalMesAnterior</b><span class="pull-right" style="font-size:small">100%</span>
            </td>
            <td class="bg-info" style="text-align:center">
                <b>@metaTotal</b><span class="pull-right" style="font-size:small">100%</span>
            </td>
            <td class="bg-info" style="text-align:center">
                <b>@realizadoTotal</b><span class="pull-right" style="font-size:small">100%</span>
            </td>
            <td class="bg-info" style="text-align:center;">
                <b>TOTAL</b>
            </td>
            <td class="bg-info" style="text-align:center">
                @{
                    int planDiferenciaFooter = planTotalMesAnteriorFooter - metaTotal;

                    if (planTotalMesAnteriorFooter > 0)
                    {
                        texto = "text-success";
                    }
                    else if (planTotalMesAnteriorFooter < 0)
                    {
                        texto = "text-danger";
                        parentesisDerecho = ")";
                        parentesisIZquierdo = "(";
                    }

                    double planPorcentajeTotalFooter = (planTotalMesAnteriorFooter * 100) / metaTotal;

                    if (planPorcentajeTotalFooter > 0)
                    {
                        texto2 = "text-success";
                    }
                    else if (planPorcentajeTotalFooter < 0)
                    {
                        texto2 = "text-danger";
                        parentesisDerecho1 = ")";
                        parentesisIZquierdo1 = "(";
                    }

                    planTotalMesAnteriorFooter *= planTotalMesAnteriorFooter < 0 ? -1 : 1;
                    planPorcentajeTotalFooter *= planPorcentajeTotalFooter < 0 ? -1 : 1;

                    <b class="@texto">@parentesisIZquierdo@planTotalMesAnteriorFooter@parentesisDerecho</b>
                    <span class="pull-right @texto2" style="font-size:small">@parentesisIZquierdo1@planPorcentajeTotalFooter.ToString("##.###")@parentesisDerecho1%</span>

                    texto = "";
                    texto2 = "";

                    parentesisDerecho = "";
                    parentesisIZquierdo = "";

                    parentesisDerecho1 = "";
                    parentesisIZquierdo1 = "";
                }
            </td>
            <td class="bg-info" style="text-align:center">
                @{
                    if (realizadoTotalMesAnteriorFooter > 0)
                    {
                        texto = "text-success";
                    }
                    else if (realizadoTotalMesAnteriorFooter < 0)
                    {
                        texto = "text-danger";
                        parentesisDerecho = ")";
                        parentesisIZquierdo = "(";
                    }


                    if (metaPorcentajeMesAnteriorDiferenciaFooter > 0)
                    {
                        texto2 = "text-success";
                    }
                    else if (metaPorcentajeMesAnteriorDiferenciaFooter < 0)
                    {
                        texto2 = "text-danger";
                        parentesisDerecho1 = ")";
                        parentesisIZquierdo1 = "(";
                    }

                    if(realizadoTotalMesAnterior == 0)
                    {
                        metaPorcentajeMesAnteriorDiferenciaFooter = 0;
                    }
                    else
                    {
                        metaPorcentajeMesAnteriorDiferenciaFooter = (realizadoTotalMesAnteriorFooter * 100) / realizadoTotalMesAnterior;
                    }

                    realizadoTotalMesAnteriorFooter *= realizadoTotalMesAnteriorFooter < 0 ? -1 : 1;
                    metaPorcentajeMesAnteriorDiferenciaFooter *= metaPorcentajeMesAnteriorDiferenciaFooter < 0 ? -1 : 1;

                    <b class="@texto">@parentesisIZquierdo@realizadoTotalMesAnteriorFooter@parentesisDerecho</b>
                    <span class="pull-right @texto" style="font-size:small">@parentesisIZquierdo1@metaPorcentajeMesAnteriorDiferenciaFooter.ToString("##.##")@parentesisDerecho1%</span>
                    texto = "";
                    texto2 = "";

                    parentesisDerecho = "";
                    parentesisIZquierdo = "";

                    parentesisDerecho1 = "";
                    parentesisIZquierdo1 = "";
                }
            </td>
            <td class="bg-info" style="text-align:center">
            </td>
        </tr>

    </table>
</div>

<!--  -----------------------------------------------------------------------------------------------------------------------------------------  -->


@{

    texto = "";
    texto2 = "";

    fecha = new DateTime(DateTime.Today.Year, 1, 1);
    fecha1 = DateTime.Today.AddDays(1);

    fecha3 = fecha.AddMonths(-1);
    fecha4 = fecha3.AddMonths(1);

    metaTotal = 0;
    realizadoTotal = 0;
    realizadoTotalMesAnterior = 0;

    realizadoTotalCalculo = 0;
    realizadoTotalCalculoMesAnterior = 0;

    realizadoHoy = 0;
    realizadoHoyMesAnterior = 0;
    realizadoHoyMesAnteriorDiferencia = 0;

    realizadoTotalMesAnteriorFooter = 0;

    metaPorcentaje = 0.00;
    metaPorcentajeMesAnterior = 0.00;
    metaPorcentajeMesAnteriorDiferencia = 0.00;
    metaPorcentajeMesAnteriorDiferenciaFooter = 0.00;

    foreach (var e in canales)
    {
        metaTotal += Convert.ToInt32(e.Meta);
    }


    foreach (var item in canales)
    {
        if (item.NombreCanal == "Call Center")
        {
            realizadoHoy = realizadosCallCenter.Where(w => w.M.FechaExpdiente >= fecha && w.M.FechaExpdiente < fecha1).Count();
        }
        else if (item.NombreCanal == "CATEM")
        {
            realizadoHoy = realizadosCATEM.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
        }
        else if (item.NombreCanal == "ALT")
        {
            realizadoHoy = realizadosALT.Where(w => w.FechaCaptura >= fecha && w.FechaCaptura < fecha1).Count();
        }
        else if (item.NombreCanal == "Gestores")
        {
            realizadoHoy = realizadosGestores.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
        }
        else if (item.NombreCanal == "Empresas")
        {
            realizadoHoy = realizadosEmpresas.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
        }
        else if (item.NombreCanal == "ALT IS")
        {
            realizadoHoy = 0;
        }
        else if (item.NombreCanal == "Medios Digitales")
        {
            realizadoHoy = 0;
        }
        realizadoTotalCalculo += realizadoHoy;
    }

    foreach (var item in canales)
    {
        if (item.NombreCanal == "Call Center")
        {
            realizadoHoyMesAnterior = realizadosCallCenter.Where(w => w.M.FechaExpdiente >= fecha3 && w.M.FechaExpdiente < fecha4).Count();
        }
        else if (item.NombreCanal == "CATEM")
        {
            realizadoHoyMesAnterior = realizadosCATEM.Where(w => w.O.M.FechaExpdiente >= fecha3 && w.O.M.FechaExpdiente < fecha4).Count();
        }
        else if (item.NombreCanal == "ALT")
        {
            realizadoHoyMesAnterior = realizadosALT.Where(w => w.FechaCaptura >= fecha3 && w.FechaCaptura < fecha4).Count();
        }
        else if (item.NombreCanal == "Gestores")
        {
            realizadoHoyMesAnterior = realizadosGestores.Where(w => w.O.M.FechaExpdiente >= fecha3 && w.O.M.FechaExpdiente < fecha4).Count();
        }
        else if (item.NombreCanal == "Empresas")
        {
            realizadoHoyMesAnterior = realizadosEmpresas.Where(w => w.O.M.FechaExpdiente >= fecha3 && w.O.M.FechaExpdiente < fecha4).Count();
        }
        else if (item.NombreCanal == "ALT IS")
        {
            realizadoHoyMesAnterior = 0;
        }
        else if (item.NombreCanal == "Medios Digitales")
        {
            realizadoHoyMesAnterior = 0;
        }
        realizadoTotalCalculoMesAnterior += realizadoHoyMesAnterior;
    }

}


@*<h3 style="color:white">Acumulado Anual</h3>
<div class="tablaScroll">
    <table class="table  table-bordered table-hover tablas" style="color: #2F2D6B">
        <thead>
            <tr style="color:white">
                <th rowspan="2" style="text-align:center">
                    Año Anterior
                </th>
                <th rowspan="2" style="text-align:center">
                    Mes Anterior
                </th>
                <th rowspan="2" style="text-align:center">
                    Meta
                </th>
                <th rowspan="2" style="text-align:center">
                    Realizado
                </th>
                <th rowspan="2" style="text-align:center">
                    @DateTime.Now.ToString("MMMM-yy").ToUpper()
                </th>
                <th colspan="3" style="font-size:x-small; text-align:center">
                    COMPARATIVO
                </th>
            </tr>
            <tr style="color:white">
                <th style="text-align:center">
                    Presupuesto
                </th>
                <th style="text-align:center">
                    Mes Anterior
                </th>
                <th style="text-align:center">
                    Año Anterior
                </th>
            </tr>
        </thead>

        @{
            foreach (var item in canales)
            {
                <tr>
                    <td style="text-align:center">
                    </td>
                    <td style="text-align:center">
                        ----------------
                    </td>
                    <td style="text-align:center">
                        @{
                            metaPorcentaje = (Convert.ToDouble(item.Meta) * 100) / metaTotal;
                            int metaPorcentajeAnual = Convert.ToInt32(item.Meta) * 12;
                        }
                        <b>@metaPorcentajeAnual</b><span class="pull-right" style="font-size:small">@metaPorcentaje.ToString("##.##")%</span>
                    </td>
                    <td style="text-align:center">
                        @{
                            if (item.NombreCanal == "Call Center")
                            {
                                realizadoHoy = realizadosCallCenter.Where(w => w.M.FechaExpdiente >= fecha && w.M.FechaExpdiente < fecha1).Count();
                            }
                            else if (item.NombreCanal == "CATEM")
                            {
                                realizadoHoy = realizadosCATEM.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
                            }
                            else if (item.NombreCanal == "ALT")
                            {
                                realizadoHoy = realizadosALT.Where(w => w.FechaCaptura >= fecha && w.FechaCaptura < fecha1).Count();
                            }
                            else if (item.NombreCanal == "Gestores")
                            {
                                realizadoHoy = realizadosGestores.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
                            }
                            else if (item.NombreCanal == "Empresas")
                            {
                                realizadoHoy = realizadosEmpresas.Where(w => w.O.M.FechaExpdiente >= fecha && w.O.M.FechaExpdiente < fecha1).Count();
                            }
                            else if (item.NombreCanal == "ALT IS")
                            {
                                realizadoHoy = 0;
                            }
                            else if (item.NombreCanal == "Medios Digitales")
                            {
                                realizadoHoy = 0;
                            }
                            realizadoTotal += realizadoHoy;
                            metaPorcentaje = (Convert.ToDouble(realizadoHoy) * 100) / realizadoTotalCalculo;
                            metaPorcentajeMesAnteriorDiferencia = metaPorcentaje - metaPorcentajeMesAnterior;
                            metaPorcentajeMesAnteriorDiferenciaFooter += metaPorcentajeMesAnteriorDiferencia;
                        }
                        <b>@realizadoHoy</b><span class="pull-right" style="font-size:small">@metaPorcentaje.ToString("##.##")%</span>
                    </td>
                    <td class="bg-info" style="text-align:center">
                        <b>@item.NombreCanal</b>
                    </td>
                    <td style="text-align:center">
                    </td>
                    <td style="text-align:center">
                        ----------------
                    </td>
                    <td style="text-align:center">
                    </td>
                </tr>
            }
        }

        <tr>
            <td class="bg-info" style="text-align:center">
            </td>
            <td class="bg-info" style="text-align:center">
                ----------------
            </td>
            <td class="bg-info" style="text-align:center">
            </td>
            <td class="bg-info" style="text-align:center">
            </td>
            <td class="bg-info" style="text-align:center;">
                <b>TOTAL</b>
            </td>
            <td class="bg-info" style="text-align:center">
            </td>
            <td class="bg-info" style="text-align:center">
                ----------------
            </td>
            <td class="bg-info" style="text-align:center">
            </td>
        </tr>

    </table>
</div>*@
