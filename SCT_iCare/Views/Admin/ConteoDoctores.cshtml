@*XLSX*@
<script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>

@{
    ViewBag.Title = "ConteoDoctores";

    GMIEntities db = new GMIEntities();

    var doctores = db.Doctores2.OrderBy(o => o.NombreDoctor);

    int flag = 1;

    int diaCorrienteHeader = 1;
    int diaCorrienteRow = 1;
    int diaCorrienteFooter = 1;

    int diaMes = DateTime.Today.Day;

    int episTotal = 0;
    int pausaTotal = 0;
    int dictamenTotal = 0;


    int episTotalTOTAL = 0;
    int pausaTotalTOTAL = 0;
    int dictamenTotalTOTAL = 0;

    int episTotalFooter = 0;
    int pausaTotalFooter = 0;
    int dictamenTotalFooter = 0;
}

<html>

    <head>

        <LINK REL=StyleSheet href="~/Estilos CSS/TablaConteoDoctores.css" TYPE="text/css" MEDIA=screen>

        <meta charset="utf-8">

        <br />
        <h2 style="color:white">Conteo por Doctor</h2>
        <br />

    </head>

    <body>

        <form class="form-inline" method="post" enctype="multipart/form-data" action="@Url.Content("~/Admin/ConteoDoctores")">
            <div>
                <select name="gestor" style="font-size:2vh" class="form-control">
                    <option>Seleccionar</option>
                    <option value="Diarias">METAS DIARIAS</option>
                    <option value="Semanales">METAS SEMANALES</option>
                    <option value="Sucursales">SUCURSALES</option>
                    @*<option value="CallCenter">CALL CENTER</option>
                        <option value="Gestores">GESTORES</option>*@
                    <option value="Alternativos">ACUMULADO ALT</option>
                    <option value="Comparacion">COMPARACIÓN</option>
                    <option value="Doctores">DOCTORES</option>
                </select>
                @*<input type="month" class="form-control" />*@
                <input type="submit" class="btn btn-info" value="Enviar" />
            </div>
        </form>

        <br />
        <div>
            <button style="background-color:limegreen" class="btn btn-info dropdown-toggle" onclick="ExportToExcel('xlsx')">Exportar Datos a XLSX</button>
        </div>

        <script>

            function ExportToExcel(type, fn, dl) {
                var elt = document.getElementById('tbl_exporttable_to_xls');
                var wb = XLSX.utils.table_to_book(elt, { sheet: "sheet1" });
                return dl ?
                    XLSX.write(wb, { bookType: type, bookSST: true, type: 'base64' }) :
                    XLSX.writeFile(wb, fn || ('Conteo Doctores.' + (type || 'xlsx')));
            }

        </script>

        <div class="page-container">
            <div class="table-container">
                <table class="table-cebra a" id="tbl_exporttable_to_xls">
                    <thead>
                        <tr>
                            <th class="sticky" id="CeldaSmall">
                                <b>DOCTOR</b>
                            </th>
                            <th class="sticky2">
                                <b>TOTAL</b>
                            </th>

                            @{


                                while (diaCorrienteHeader <= diaMes)
                                {
                                    DateTime fecha = new DateTime(DateTime.Today.Year, DateTime.Today.Month, diaCorrienteHeader);
                                    string fechaString = fecha.ToString("dd");
                                    <td>
                                        @fechaString
                                    </td>
                                    diaCorrienteHeader++;

                                }

                                diaCorrienteHeader = 1;
                            }
                        </tr>
                    </thead>

                    <tbody>


                        @foreach (var item in doctores)
                        {

                            <tr>

                                <th class="sticky" id="Especial">
                                    <b>@item.NombreDoctor</b>
                                </th>

                                @{


                                    while (diaCorrienteRow <= diaMes)
                                    {
                                        DateTime fecha = new DateTime(DateTime.Today.Year, DateTime.Today.Month, diaCorrienteRow);
                                        DateTime fecha1 = new DateTime(DateTime.Today.Year, DateTime.Today.Month, diaCorrienteRow).AddDays(1);


                                        var epis = (from i in db.ConteoDoctores2 where i.Doctor == item.NombreDoctor && i.Fecha >= fecha && i.Fecha < fecha1 select i.Citas).FirstOrDefault();

                                        episTotal += Convert.ToInt32(epis);

                                        diaCorrienteRow++;

                                    }

                                    episTotalTOTAL += episTotal;

                                    diaCorrienteRow = 1;
                                }

                                <th class="sticky2" id="Grisaseo">
                                    <b>@episTotal</b>
                                </th>

                                @{


                                    while (diaCorrienteRow <= diaMes)
                                    {
                                        DateTime fecha = new DateTime(DateTime.Today.Year, DateTime.Today.Month, diaCorrienteRow);
                                        DateTime fecha1 = new DateTime(DateTime.Today.Year, DateTime.Today.Month, diaCorrienteRow).AddDays(1);


                                        var epis = (from i in db.ConteoDoctores2 where i.Doctor == item.NombreDoctor && i.Fecha >= fecha && i.Fecha < fecha1 select i.Citas).FirstOrDefault();

                                        episTotal += Convert.ToInt32(epis);

                                        <td >
                                            @epis
                                        </td>
                                        diaCorrienteRow++;

                                    }

                                    diaCorrienteRow = 1;
                                }

                                @{
                                    episTotal = 0;
                                }

                            </tr>

                            flag += 1;

                        }

                    </tbody>

                </table>

            </div>

        </div>

    </body>

</html>

