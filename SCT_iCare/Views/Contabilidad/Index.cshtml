@*XLSX *@
<script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>

@{
    GMIEntities db = new GMIEntities();
    var oUser = (Usuarios)HttpContext.Current.Session["User"];
    ViewBag.Title = "Index";

    int flag = 1;

    DateTime fechaInicio = DateTime.Today;
    DateTime fechaFinal = DateTime.Today.AddDays(1);

    string sucursal = "";
    string cuenta = null;
    string canal = "";
    string pago = "";
    string referido = "";
    string tipoReferido = "";

    if (ViewBag.FechaInicio != null)
    {
        fechaInicio = Convert.ToDateTime(ViewBag.FechaInicio);
    }

    if (ViewBag.FechaFinal != null)
    {
        fechaFinal = Convert.ToDateTime(ViewBag.FechaFinal);
        fechaFinal = fechaFinal.AddDays(1);
    }

    if (ViewBag.Sucursal != "")
    {
        sucursal = ViewBag.Sucursal;
    }

    if (ViewBag.Canal != "")
    {
        canal = ViewBag.Canal;
    }

    if (ViewBag.Pago != "")
    {
        pago = ViewBag.Pago;
    }

    int idReferido = ViewBag.idReferido;

    if (ViewBag.Referido != "" && ViewBag.idReferido != 0)
    {
        referido = ViewBag.Referido;
        var Tipo = (from i in db.Referido where i.idReferido == idReferido select i).FirstOrDefault();
        tipoReferido = Tipo.Tipo;
    }

    string nombreExcel = "Contabilidad";

    if (ViewBag.Cuenta != "")
    {
        cuenta = ViewBag.Cuenta;
        nombreExcel = ViewBag.Cuenta;
    }

    if(ViewBag.Cuenta == "TODOS")
    {
        cuenta = "";
        sucursal = "";
    }


    var modelo = db.Paciente.Join(db.Cita, n => n.Folio, m => m.Folio, (n, m) => new { N = n, M = m }).
Where(s => s.M.FechaReferencia >= fechaInicio && s.M.FechaReferencia < fechaFinal
&& s.M.Asistencia == null && s.M.TipoTramite != "REVALORACIÓN" && (s.M.ReferidoPor.Contains(referido) && s.M.CanalTipo.Contains(tipoReferido) && s.M.Sucursal.Contains(sucursal) && s.M.CanalTipo.Contains(canal) && s.M.Cuenta == cuenta && s.M.TipoPago.Contains(pago)));


    var modelo1 = db.PacienteESP.Where(s => s.ReferidoPor.Contains(referido) && s.CanalTipo.Contains(tipoReferido) && s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.TipoTramite != "REVALORACIÓN" && s.Asistencia == null && (s.CanalTipo.Contains(canal) && s.Cuenta == cuenta && s.TipoPago.Contains(pago)));


    var modeloExcel = db.Paciente.Join(db.Cita, n => n.Folio, m => m.Folio, (n, m) => new { N = n, M = m }).
Where(s => s.M.ReferidoPor.Contains(referido) && s.M.CanalTipo.Contains(tipoReferido) && s.M.FechaReferencia >= fechaInicio && s.M.FechaReferencia < fechaFinal && s.M.Asistencia == null && s.M.TipoTramite != "REVALORACIÓN");

    var modeloExcel1 = db.PacienteESP.Where(s => s.ReferidoPor.Contains(referido) && s.CanalTipo.Contains(tipoReferido) && s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.Asistencia == null && s.TipoTramite != "REVALORACIÓN");

    if (ViewBag.Cuenta == "TODOS")
    {
        modelo = db.Paciente.Join(db.Cita, n => n.Folio, m => m.Folio, (n, m) => new { N = n, M = m }).Where(s => s.M.FechaReferencia >= fechaInicio && s.M.FechaReferencia < fechaFinal && s.M.TipoTramite != "REVALORACIÓN" && s.M.Asistencia == null);
        modelo1 = db.PacienteESP.Where(s => s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.Asistencia == null && s.TipoTramite != "REVALORACIÓN");
        modeloExcel = db.Paciente.Join(db.Cita, n => n.Folio, m => m.Folio, (n, m) => new { N = n, M = m }).Where(s => s.M.FechaReferencia >= fechaInicio && s.M.FechaReferencia < fechaFinal && s.M.TipoTramite != "REVALORACIÓN" && s.M.Asistencia == null);
        modeloExcel1 = db.PacienteESP.Where(s => s.FechaCaptura >= fechaInicio && s.FechaCaptura < fechaFinal && s.Asistencia == null && s.TipoTramite != "REVALORACIÓN");
        cuenta = "TODOS";
    }

}

<br />
<h2 style="color: white">Contabilidad</h2>
<br />

<form class="form-inline" method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/Index")">
    <div>

        <select name="sucursal" style="font-size:2vh" class="form-control">
            @{
                if (ViewBag.Sucursal == "")
                {
                    <option value="">SUCURSAL</option>
                }
                else
                {
                    <option value="@sucursal">@sucursal</option>
                }
            }

            @{
                foreach (var item in db.Sucursales)
                {
                    <option value="@item.Nombre">@item.Nombre</option>
                }
            }
        </select>

        <select name="cuenta" style="font-size:2vh" class="form-control">
            @{
                if (ViewBag.Cuenta == null || ViewBag.Cuenta == "")
                {
                    <option value="">CUENTA</option>
                }
                else
                {
                    <option value="@cuenta">@cuenta.ToUpper()</option>
                }
            }
            <option value="BANCOS">BANCOS</option>
            <option value="CONEKTA">CONEKTA</option>
            <option value="ANTICIPOS">ANTICIPOS</option>
            <option value="CUENTAS X COBRAR">CUENTAS X COBRAR</option>
            <option value="CORPORATIVO">CORPORATIVO</option>
            <option value="ACLARACIONES">ACLARACIONES</option>
            <option value="DEVOLUCIONES">DEVOLUCIONES</option>
            <option value="TODOS">TODOS</option>
        </select>

        <select name="canal" style="font-size:2vh" class="form-control">
            @{
                if (ViewBag.Canal == "")
                {
                    <option value="">CANAL</option>
                }
                else
                {
                    <option value="@canal">@canal.ToUpper()</option>
                }
            }
            @{
                foreach (var item in db.Canales)
                {
                    <option value="@item.NombreCanal">@item.NombreCanal</option>
                }
            }
        </select>

        <select name="tipoPago" style="font-size:2vh" class="form-control">
            @{
                if (ViewBag.Pago == "" || ViewBag.Pago == null)
                {
                    <option value="">TIPO DE PAGO</option>
                }
                else
                {
                    <option value="@pago">@pago</option>
                }
            }
            <option value="Referencia OXXO">Referencia OXXO</option>
            <option value="Referencía BanBajío">Referencía BanBajío</option>
            <option value="Transferencia vía BanBajío">Transferencia vía BanBajío</option>
            <option value="BanCoppel">BanCoppel</option>
            <option value="BanCoppel TLS">BanCoppel TLS</option>
            <option value="BanCoppel LC">BanCoppel LC</option>
            <option value="Banco Azteca TLS">Banco Azteca TLS</option>
            <option value="Banco Azteca LC">Banco Azteca LC</option>
            <option value="Cuenta Externa">Cuenta Externa</option>
            <option value="Pendiente de Pago">Pendiente de Pago</option>
        </select>

        <select name="referido" style="font-size:2vh" class="form-control">
            @{
                if (ViewBag.Referido == "" || ViewBag.Referido == null)
                {
                    <option value="">REFERIDO POR</option>
                }
                else
                {
                    <option value="@referido">@referido</option>
                }
            }
            @foreach (var item in db.Referido.OrderBy(o => o.Tipo).ThenBy(o => o.Nombre))
            {
                <option value="@item.idReferido">@item.Nombre -- @item.Tipo</option>
            }

        </select>

        @{

            DateTime ViewBagFechaInicio = Convert.ToDateTime(ViewBag.fechaInicio);
            var SetFechaInicio = ViewBagFechaInicio.Date.ToString("yyyy-MM-dd");

            if (ViewBag.fechaInicio != null)
            {

                <input type="date" name="fechaInicio" class="form-control" value="@SetFechaInicio" />

            }

            else

            {

                <input type="date" name="fechaInicio" class="form-control" value="" />

            }

        }

        @{

            DateTime ViewBagFechaFinal = Convert.ToDateTime(ViewBag.fechaFinal);
            var SetFechaFinal = ViewBagFechaFinal.Date.ToString("yyyy-MM-dd");

            if (ViewBag.fechaFinal != null)
            {

                <input type="date" name="fechaFinal" class="form-control" value="@SetFechaFinal" />

            }

            else

            {

                <input type="date" name="fechaFinal" class="form-control" value="" />

            }

        }



        <input type="submit" class="btn btn-info" value="Enviar" />
        <a href="~/Contabilidad/Index"><button type="button" class="btn btn-success">Limpiar</button></a>

    </div>


</form>

<script>

    function ExportToExcel(type, fn, dl) {
        var elt = document.getElementById('tbl_exporttable_to_xls');
        var wb = XLSX.utils.table_to_book(elt, { sheet: "sheet1" });
        return dl ?
            XLSX.write(wb, { bookType: type, bookSST: true, type: 'base64' }) :
            XLSX.writeFile(wb, fn || ('@nombreExcel' + ' @Convert.ToDateTime(fechaInicio).ToString("dd-MM-yy").' + (type || 'xlsx')));
    }

</script>

|   <div>
        <button style="background-color:limegreen" class="btn btn-info dropdown-toggle" onclick="ExportToExcel('xlsx')">Exportar Datos a XLSX</button>
    </div>

<br />
<div class="tablaScroll" style="min-height: 1000px">
    <table class="table  table-hover tablas" style="color: #2F2D6B">
        <thead style="color:white">
            <tr>
                <th></th>
                <th>
                    Nombre
                </th>
                <th>
                    FechaCita
                </th>
                <th>
                    Sucursal
                </th>
                <th>
                    Referencia
                </th><!--Referido Por(vía y canal), Tipo de pago (Conekta, BanBajio, Banco Alternativo) / Fecha de pago-->
                <th>
                    Canal
                </th>
                <th>
                    ReferidoPor
                </th>
                <th>
                    Cuenta
                </th>
                <th>
                    TipoPago
                </th>
                <th>
                    FechaPago
                </th>
                <th>
                    FechaContable
                </th>
                <th>
                    Precio
                </th>
                <th>
                    Usuario
                </th>
                <th></th>
            </tr>
        </thead>

        @{
            foreach (var item in modelo)
            {
                <tr>
                    <td>
                        @flag
                    </td>
                    <td style="font-size:smaller">
                        @{
                            string[] historico = item.M.CuentaComentario != null ? item.M.CuentaComentario.Split('+') : null;
                            int flag0 = 1;

                            if (item.M.CuentaComentario == null)
                            {
                                <b>@item.N.Nombre</b>
                            }
                            else
                            {
                                <span class="field-tip">
                                    <b>@item.N.Nombre</b>
                                    <span class="tip-content">
                                        @{
                                            foreach (var i in historico)
                                            {
                                                <span>@flag0 @i</span><br />
                                                flag0++;
                                            }
                                        }
                                    </span>
                                </span>
                            }
                        }
                    </td>
                    <td>
                        @Convert.ToDateTime(item.M.FechaCita).ToString("dd-MM-yy")
                    </td>

                    <td style="font-size:smaller">
                        @item.M.Sucursal
                    </td>
                    <td style="font-size:smaller">
                        @item.M.Referencia
                    </td>
                    <td style="font-size:smaller">
                        <b>@item.M.CanalTipo</b>
                    </td>
                    <td style="font-size:smaller">
                        <b>@item.M.ReferidoPor</b>
                    </td>
                    <td>
                        @{
                            if (item.M.Cuenta == null)
                            {
                                <span>Caja</span>
                            }
                            else
                            {
                                <span>@item.M.Cuenta</span>
                            }
                        }
                    </td>
                    <td>
                        @{
                            if (item.M.TipoPago == "Referencia OXXO" || item.M.TipoPago == "Pago con Tarjeta")
                            {
                                <span>Conekta</span>
                            }
                            else if (item.M.TipoPago == "Referencia BanBajío" || item.M.TipoPago == "Transferencia vía BanBajío")
                            {
                                <span>BanBajío</span>
                            }
                            else if (item.M.TipoPago == "Pendiente de Pago")
                            {
                                <span>Pendiente</span>
                            }
                            else
                            {
                                <span>@item.M.TipoPago</span>
                            }
                        }
                    </td>
                    <td>
                        @Convert.ToDateTime(item.M.FechaReferencia).ToString("dd-MM-yy")
                    </td>
                    <td>
                        @if (item.M.FechaContable == null)
                        {
                            <span>------</span>
                        }
                        else
                        {
                            @Convert.ToDateTime(item.M.FechaContable).ToString("dd-MM-yy")
                        }
                    </td>
                    <td>
                        @{
                            if (item.M.TipoLicencia != "AEREO")
                            {
                                var costo = (from i in db.Referido where i.Nombre == item.M.ReferidoPor && i.Tipo == item.M.CanalTipo select i).FirstOrDefault();

                                if (costo.PrecioNormalconIVA != null)
                                {
                                    <span><b>$@Convert.ToDouble(costo.PrecioNormalconIVA).ToString("####.##")</b></span>
                                }
                                else
                                {
                                    <span><b>$@Convert.ToDouble(costo.PrecioNormal).ToString("####.##")</b></span>
                                }
                            }
                        }
                    </td>
                    <td>
                        @item.M.Recepcionista
                    </td>
                    <td>
                        <div class="btn-group">
                            <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Acciones <span class="glyphicon glyphicon-triangle-bottom"></span>
                            </button>

                            <div class="dropdown-menu" style="padding:10px">
                                <a href="#" data-toggle="modal" data-target="#Efectivo_@item.M.idCita"><b>Bancos</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#Conekta_@item.M.idCita"><b>Conekta</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#Anticipos_@item.M.idCita"><b>Anticipos</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#CXC_@item.M.idCita"><b>CuentasXCobrar</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#Corporativo_@item.M.idCita"><b>Corporativo</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#Aclaracion_@item.M.idCita"><b>Aclaracion</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#Devoluciones_@item.M.idCita"><b>Devoluciones</b></a>
                                <div class="dropdown-divider"></div>

                            </div>

                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Efectivo_@item.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a BANCOS?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.M.idCita" />
                                                <input type="hidden" name="cuenta" value="BANCOS" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.M.Doctor</b><br />
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Conekta -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Conekta_@item.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a Conekta?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.M.idCita" />
                                                <input type="hidden" name="cuenta" value="CONEKTA" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.M.Doctor</b><br />
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- OXXO -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Anticipos_@item.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a ANTICIPOS?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.M.idCita" />
                                                <input type="hidden" name="cuenta" value="ANTICIPOS" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.M.Doctor</b><br />
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="CXC_@item.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a CUENTAS X COBRAR?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.M.idCita" />
                                                <input type="hidden" name="cuenta" value="CUENTAS X COBRAR" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.M.Doctor</b><br />
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Corporativo_@item.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a CORPORATIVO?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.M.idCita" />
                                                <input type="hidden" name="cuenta" value="CORPORATIVO" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.M.Doctor</b><br />
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Aclaracion_@item.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a ACLARACIONES?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.M.idCita" />
                                                <input type="hidden" name="cuenta" value="ACLARACIONES" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.M.Doctor</b><br />
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuenta")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Devoluciones_@item.M.idCita" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta DEVOLUCIONES?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.M.idCita" />
                                                <input type="hidden" name="cuenta" value="DEVOLUCIONES" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.N.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.N.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.M.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.M.FechaReferencia).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Sucursal:</label>
                                                    <b>@item.M.Sucursal</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.M.Doctor</b><br />
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                        </div>

                    </td>
                </tr>
                flag++;
            }
        }

        @{
            foreach (var item in modelo1)
            {
                <tr>
                    <td>
                        @flag
                    </td>
                    <td style="font-size:smaller">
                        @{
                            string[] historico = item.CuentaComentario != null ? item.CuentaComentario.Split('+') : null;
                            int flag0 = 1;

                            if (item.CuentaComentario == null)
                            {
                                <b>@item.Nombre</b>
                            }
                            else
                            {
                                <span class="field-tip">
                                    <b>@item.Nombre</b>
                                    <span class="tip-content">
                                        @{
                                            foreach (var i in historico)
                                            {
                                                <span>@flag0 @i</span><br />
                                                flag0++;
                                            }
                                        }
                                    </span>
                                </span>
                            }
                        }
                    </td>
                    <td>
                        @Convert.ToDateTime(item.FechaCaptura).ToString("dd-MM-yy")
                    </td>

                    <td>
                        -----
                    </td>
                    <td>
                        -----
                    </td>
                    <td style="font-size:smaller">
                        <b>@item.CanalTipo</b>
                    </td>
                    <td style="font-size:smaller">
                        <b>@item.ReferidoPor</b>
                    </td>
                    <td>
                        @{
                            if (item.Cuenta == null)
                            {
                                <span>Caja</span>
                            }
                            else
                            {
                                <span>@item.Cuenta</span>
                            }
                        }
                    </td>
                    <td>
                        @item.TipoPago
                    </td>
                    <td>
                        @Convert.ToDateTime(item.FechaSolicitud).ToString("dd-MM-yy")
                    </td>
                    <td>
                        @if (item.FechaContable == null)
                        {
                            <span>------</span>
                        }
                        else
                        {
                            @Convert.ToDateTime(item.FechaContable).ToString("dd-MM-yy")
                        }
                    </td>
                    <td>
                        @{
                            if (item.TipoLicencia != "AEREO")
                            {
                                var costo = (from i in db.Referido where i.Nombre == item.ReferidoPor && i.Tipo == item.CanalTipo select i).FirstOrDefault();

                                if (costo.PrecioNormalconIVA != null)
                                {
                                    <span><b>$@Convert.ToDouble(costo.PrecioNormalconIVA).ToString("####.##")</b></span>
                                }
                                else
                                {
                                    <span><b>$@Convert.ToDouble(costo.PrecioNormal).ToString("####.##")</b></span>
                                }
                            }
                        }
                    </td>
                    <td>
                        @item.Solicita
                    </td>
                    <td>
                        <div class="btn-group">
                            <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Acciones <span class="glyphicon glyphicon-triangle-bottom"></span>
                            </button>

                            <div class="dropdown-menu" style="padding:10px">
                                <a href="#" data-toggle="modal" data-target="#Efectivo1_@item.idPacienteESP"><b>Bancos</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#Conekta1_@item.idPacienteESP"><b>Conekta</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#Anticipos1_@item.idPacienteESP"><b>Anticipos</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#CXC1_@item.idPacienteESP"><b>CuentasXCobrar</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#Corporativo1_@item.idPacienteESP"><b>Corporativo</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#Aclaracion1_@item.idPacienteESP"><b>Aclaracion</b></a>
                                <div class="dropdown-divider"></div>
                                <a href="#" data-toggle="modal" data-target="#Devoluciones1_@item.idPacienteESP"><b>Devoluciones</b></a>
                                <div class="dropdown-divider"></div>

                            </div>

                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Efectivo1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a BANCOS?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="BANCOS" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Conekta1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a Conekta?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="CONEKTA" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- OXXO -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Anticipos1_@item..idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a ANTICIPOS?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="ANTICIPOS" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="CXC1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a CUENTAS X COBRAR?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="CUENTAS X COBRAR" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>


                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Corporativo1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a CORPORATIVO?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="CORPORATIVO" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Aclaracion1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a ACLARACIONES?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="ACLARACIONES" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <!-- Efectivo -->
                            <form method="post" enctype="multipart/form-data" action="@Url.Content("~/Contabilidad/CambiarCuentaALT")">
                                @Html.AntiForgeryToken()
                                <div class="modal fade" id="Devoluciones1_@item.idPacienteESP" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="exampleModalLabel"><b>¿Está seguro de mandar los datos de esta venta a DEVOLUCIONES?</b></h4>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="id" value="@item.idPacienteESP" />
                                                <input type="hidden" name="cuenta" value="DEVOLUCIONES" />
                                                <div class="form-group" style="width:60%; min-width:320px">
                                                    <label for="recipient-name" class="col-form-label">Nombre:</label>
                                                    <b>@item.Nombre</b><br />
                                                    <label for="recipient-name" class="col-form-label">CURP:</label>
                                                    <b>@item.CURP</b><br />
                                                    <label for="recipient-name" class="col-form-label">NoExpediente:</label>
                                                    <b>@item.NoExpediente</b><br />
                                                    <label for="recipient-name" class="col-form-label">Fecha:</label>
                                                    <b>@Convert.ToDateTime(item.FechaCaptura).ToString("dd-MMMM-yyyy")</b><br />
                                                    <label for="recipient-name" class="col-form-label">Doctor:</label>
                                                    <b>@item.Doctor</b><br />
                                                    <label for="recipient-name" class="col-form-label">Tipo de Pago:</label>
                                                    <select required name="pago" style="width:100%; min-height:5vh; min-width:99%; font-size:2vh" class="form-select">
                                                        <option selected disabled>Seleccionar</option>
                                                        <option value="BanCoppel TLS">BanCoppel TLS</option>
                                                        <option value="BanCoppel LC">BanCoppel LC</option>
                                                        <option value="Banco Azteca TLS">Banco Azteca TLS</option>
                                                        <option value="Banco Azteca LC">Banco Azteca LC</option>
                                                        <option value="Cuenta Externa">Cuenta Externa</option>
                                                    </select>
                                                    <br />
                                                    <label for="recipient-name" class="col-form-label">Fecha de pago contable:</label>
                                                    <input type="date" class="form-control" name="fechaContable" />
                                                    <label for="recipient-name" class="col-form-label">¿Desea agregar un comentario?:</label>
                                                    <input type="text" class="form-control" name="comentario" />
                                                    <input type="hidden" name="usuario" value="@oUser.Nombre" />
                                                    <input type="hidden" name="fechaInicio" value="@fechaInicio" />
                                                    <input type="hidden" name="fechaFinal" value="@fechaFinal" />
                                                    <input type="hidden" name="cuenta2" value="@cuenta" />
                                                    <input type="hidden" name="canal" value="@canal" />
                                                    <input type="hidden" name="sucursal" value="@sucursal" />
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <input type="submit" value="Enviar" class="btn btn-primary" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                        </div>

                    </td>
                </tr>
                flag++;
            }
        }

    </table>
</div>

@*Tabla Invisible*@

<div class="tablaScroll" style="display: none">
    <table id="tbl_exporttable_to_xls" class="table  table-hover tablas" style="color: #2F2D6B; display: none">
        <thead style="color:white">
            <tr>
                <th>
                    Nombre
                </th>
                <th>
                    Fecha Cita
                </th>
                <th>
                    Sucursal
                </th>
                <th>
                    Referencia
                </th><!--Referido Por(vía y canal), Tipo de pago (Conekta, BanBajio, Banco Alternativo) / Fecha de pago-->
                <th>
                    ReferidoPor
                </th>
                <th>
                    TipoPago
                </th>
                <th>
                    FechaPago
                </th>
                <th>
                    FechaContable
                </th>
                <th>
                    Comisión
                </th>
                <th>
                    Precio
                </th>
                <th>
                    Recepcionista
                </th>
                <th>
                    Contabilidad
                </th>
                <th>
                    Cuenta
                </th>
                <th>
                    Movimientos de cuenta
                </th>
            </tr>
        </thead>

        @{
            foreach (var item in modeloExcel)
            {
                <tr>
                    <td>
                        <b>@item.N.Nombre</b>
                    </td>
                    <td>
                        @Convert.ToDateTime(item.M.FechaCita).AddDays(1).ToString("dd-MMMM-yyyy")
                    </td>
                    <td>
                        @item.M.Sucursal
                    </td>
                    <td>
                        @item.M.Referencia
                    </td>
                    <td>
                        <span class="field-tip">
                            <b>@item.M.ReferidoPor</b>
                            <span class="tip-content">
                                Canal: @item.M.CanalTipo
                            </span>
                        </span>
                    </td>
                    <td>
                        @{
                            if (item.M.TipoPago == "Referencia OXXO" || item.M.TipoPago == "Pago con Tarjeta")
                            {
                                <span>Conekta</span>
                            }
                            else if (item.M.TipoPago == "Referencia BanBajío" || item.M.TipoPago == "Transferencia vía BanBajío")
                            {
                                <span>BanBajío</span>
                            }
                            else
                            {
                                <span>@item.M.TipoPago</span>
                            }
                        }
                    </td>
                    <td>
                        @Convert.ToDateTime(item.M.FechaReferencia).AddDays(1).ToString("dd-MMMM-yyyy")
                    </td>
                    <td>
                        @if (item.M.FechaContable == null)
                        {
                            <span>------</span>
                        }
                        else
                        {
                            @Convert.ToDateTime(item.M.FechaContable).ToString("dd-MM-yy")
                        }
                    </td>
                    <td>
                    </td>
                    <td>
                        @{
                            if (item.M.TipoLicencia != "AEREO")
                            {
                                var costo = (from i in db.Referido where i.Nombre == item.M.ReferidoPor && i.Tipo == item.M.CanalTipo select i).FirstOrDefault();

                                if (costo.PrecioNormalconIVA != null)
                                {
                                    <span><b>$@Convert.ToDouble(costo.PrecioNormalconIVA).ToString("####.##")</b></span>
                                }
                                else
                                {
                                    <span><b>$@Convert.ToDouble(costo.PrecioNormal).ToString("####.##")</b></span>
                                }
                            }
                        }
                    </td>
                    <td>
                        @item.M.Recepcionista
                    </td>
                    <td>
                    </td>
                    <td>
                        @{
                            if (item.M.Cuenta == null)
                            {
                                <span>CAJA</span>
                            }
                            else
                            {
                                <span>@item.M.Cuenta</span>
                            }
                        }
                    </td>
                    <td>
                        @item.M.CuentaComentario
                    </td>

                </tr>
            }
        }

        @{
            foreach (var item in modeloExcel1)
            {
                <tr>
                    <td>
                        <b>@item.Nombre</b>
                    </td>
                    <td>
                        @Convert.ToDateTime(item.FechaCaptura).AddDays(1).ToString("dd-MMMM-yyyy")
                    </td>
                    <td>
                        -----
                    </td>
                    <td>
                        -----
                    </td>
                    <td>
                        <span class="field-tip">
                            <b>@item.ReferidoPor</b>
                            <span class="tip-content">
                                Canal: @item.CanalTipo
                            </span>
                        </span>
                    </td>
                    <td>
                        @item.TipoPago
                    </td>
                    <td>
                        @Convert.ToDateTime(item.FechaSolicitud).AddDays(1).ToString("dd-MMMM-yyyy")
                    </td>
                    <td>
                        @if (item.FechaContable == null)
                        {
                            <span>------</span>
                        }
                        else
                        {
                            @Convert.ToDateTime(item.FechaContable).ToString("dd-MM-yy")
                        }
                    </td>
                    <td>
                    </td>
                    <td>
                        @{
                            if (item.TipoLicencia != "AEREO")
                            {
                                var costo = (from i in db.Referido where i.Nombre == item.ReferidoPor && i.Tipo == item.CanalTipo select i).FirstOrDefault();

                                if (costo.PrecioNormalconIVA != null)
                                {
                                    <span><b>$@Convert.ToDouble(costo.PrecioNormalconIVA).ToString("####.##")</b></span>
                                }
                                else
                                {
                                    <span><b>$@Convert.ToDouble(costo.PrecioNormal).ToString("####.##")</b></span>
                                }
                            }
                        }
                    </td>
                    <td>
                        @item.Solicita
                    </td>
                    <td>
                    </td>
                    <td>
                        @{
                            if (item.Cuenta == null)
                            {
                                <span>CAJA</span>
                            }
                            else
                            {
                                <span>@item.Cuenta</span>
                            }
                        }
                    </td>
                    <td>
                        @item.CuentaComentario
                    </td>
                </tr>
            }


}

    </table>
</div>

